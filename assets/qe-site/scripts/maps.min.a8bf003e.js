OAM.ready((function(){var b=$("[data-map]");b.length&&(b.on("click",(function(a){a.preventDefault()})),b.one("show.roam.visibility",(function(){b.roam_visibility("unwatch"),OAM.script("https://maps.googleapis.com/maps/api/js?key="+b.data("mapApiKey")+"&libraries=places&callback=roam_mapInit")})),b.roam_visibility(),b.roam_visibility("watch"),window.roam_mapInit=function(){b.not("[data-editable]").each((function(){var a=$(this),e=a.find("[data-map-placeholder]"),t=a.find("[data-map-preview]"),o={lat:parseFloat(a.data("mapLat")),lng:parseFloat(a.data("mapLng"))},n=new google.maps.Map(e.get(0),{center:o,zoom:parseInt(a.data("mapZoom")||8,10),zoomControl:!0,scrollwheel:!1,gestureHandling:"cooperative"});new google.maps.Marker({position:o,map:n}),t.remove()})),b.filter("[data-editable]").each((function(){var a=$(this),e=a.find("[data-map-placeholder]"),t=a.find("[data-map-preview]"),o=a.find("[data-map-location]"),n=a.find("[data-map-location-current]"),i=a.find("[data-map-location-search]"),r=a.find("[data-map-location-search-btn]"),l=a.find("[data-map-location-search-input]"),s=a.data("target"),d=$(s),c=d.find('[name="latitude"]'),p=d.find('[name="longitude"]'),m=parseFloat(c.val()),g=parseFloat(p.val()),u=parseFloat(b.data("map-default-lat")),f=parseFloat(b.data("map-default-lng"));m&&g&&!isNaN(m)&&!isNaN(g)||(m=u,g=f);var v=m!=u&&g!=f,h=new google.maps.LatLng(m,g),w=new google.maps.Map(e.get(0),{center:h,gestureHandling:"cooperative",zoom:parseInt(v?16:12),zoomControl:!0}),y=new google.maps.Marker({draggable:!0,position:h,map:w});r.on("click",(function(){r.hide(),i.show(),l.on("keypress",(function(a){13===a.keyCode&&a.preventDefault()}));var e=new google.maps.places.Autocomplete(l.get(0),{});e.addListener("place_changed",(function(){var a=e.getPlace();a.geometry&&(a.geometry.viewport?w.fitBounds(a.geometry.viewport):(w.setCenter(a.geometry.location),w.setZoom(16)),y.setPosition(a.geometry.location),v=!0)}))})),navigator.geolocation?n.on("click",(function(){navigator.geolocation.getCurrentPosition((function(a){var e={lat:a.coords.latitude,lng:a.coords.longitude};console.log(e),$.isNumeric(e.lat)&&$.isNumeric(e.lng)&&(w.setCenter(e),y.setPosition(e),w.setZoom(16),v=!0)}),(function(a){}),{enableHighAccuracy:!0,timeout:1e4,maximumAge:1/0})})):n.remove(),d.on("change.map",'[name="location_id"]',(function(){var a,e,t;v||(a=$("option:selected",this),e={lat:parseFloat(a.data("latitude")),lng:parseFloat(a.data("longitude"))},$.isNumeric(e.lat)&&$.isNumeric(e.lng)&&(w.setCenter(e),y.setPosition(e),(t=w.getBounds()).extend(y.position),w.fitBounds(t)))})),y.addListener("dragend",(function(){var a=y.getPosition();w.setCenter(a),v=!0})),y.addListener("position_changed",(function(){var a=y.getPosition();c.val(a.lat()),p.val(a.lng())})),a.data("map",w),a.data("marker",y),t.remove(),o.removeClass("hidden")}))})}));